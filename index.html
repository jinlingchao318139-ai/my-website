<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>存款阶段日均计算器 - 日期版本</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 25px;
        }
        
        .input-section {
            flex: 1;
            min-width: 400px;
            padding: 20px;
            border-right: 1px solid #eee;
        }
        
        .result-section {
            flex: 1;
            min-width: 400px;
            padding: 20px;
        }
        
        .section-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeff5;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }
        
        .input-with-unit {
            position: relative;
        }
        
        .unit {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: #4a6491;
            outline: none;
            box-shadow: 0 0 0 2px rgba(74, 100, 145, 0.1);
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            border: none;
            padding: 14px 25px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(to right, #1a2530, #3a5075);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #27ae60, #2ecc71);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(to right, #219653, #27ae60);
        }
        
        .btn-tertiary {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }
        
        .btn-tertiary:hover {
            background: linear-gradient(to right, #8e44ad, #7d3c98);
        }
        
        .result-card {
            background-color: #f9fbfd;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #4a6491;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
        }
        
        .result-value {
            font-size: 36px;
            font-weight: 700;
            color: #2c3e50;
            text-align: center;
            margin: 15px 0;
        }
        
        .result-label {
            text-align: center;
            font-size: 18px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .result-note {
            text-align: center;
            font-size: 14px;
            color: #777;
            margin-top: 10px;
        }
        
        .details {
            margin-top: 25px;
            font-size: 14px;
            color: #666;
        }
        
        .details strong {
            color: #2c3e50;
        }
        
        .details p {
            margin-bottom: 8px;
        }
        
        .calculation-formula {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #2c3e50;
            border-left: 3px solid #4a6491;
        }
        
        .example-section {
            background-color: #fff8e1;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-top: 25px;
            border-radius: 0 4px 4px 0;
        }
        
        .example-title {
            font-weight: 600;
            color: #e67e22;
            margin-bottom: 10px;
        }
        
        .scenario-selector {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .scenario-btn {
            padding: 8px 15px;
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .scenario-btn:hover {
            background-color: #d5dbdb;
        }
        
        .scenario-btn.active {
            background-color: #4a6491;
            color: white;
            border-color: #4a6491;
        }
        
        .explanation-section {
            width: 100%;
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .explanation-content {
            margin-top: 15px;
            line-height: 1.7;
        }
        
        .explanation-content h3 {
            color: #2c3e50;
            margin: 15px 0 10px 0;
        }
        
        .explanation-content ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .explanation-content li {
            margin-bottom: 5px;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
            background-color: #f9fbfd;
        }
        
        .toggle-container {
            display: flex;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .toggle-btn.active {
            background-color: #4a6491;
            color: white;
        }
        
        .calculator-type {
            display: none;
        }
        
        .calculator-type.active {
            display: block;
        }
        
        .info-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background-color: #4a6491;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            margin-left: 5px;
            cursor: help;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2c3e50;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            font-weight: normal;
            line-height: 1.5;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .date-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-range-item {
            flex: 1;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .phase-result-card {
            background-color: #f0f9ff;
            border-left: 4px solid #3498db;
        }
        
        .loan-result-card {
            background-color: #f0fff4;
            border-left: 4px solid #27ae60;
        }
        
        .period-result-card {
            background-color: #f9f0ff;
            border-left: 4px solid #9b59b6;
        }
        
        .result-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .result-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .result-tab.active {
            border-bottom: 3px solid #4a6491;
            color: #4a6491;
        }
        
        .result-content {
            display: none;
        }
        
        .result-content.active {
            display: block;
        }
        
        .summary-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-item {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }
        
        .summary-label {
            font-size: 13px;
            color: #777;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .date-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-input-group .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .calc-date-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .calc-date-group .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .today-btn {
            padding: 12px 15px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .today-btn:hover {
            background-color: #e9ecef;
        }
        
        .date-info-display {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }
        
        .date-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .date-info-label {
            font-weight: 500;
            color: #444;
        }
        
        .date-info-value {
            font-weight: 600;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>存款阶段日均计算器 - 日期版本</h1>
            <p class="subtitle">客户经理专业工具 - 使用日期选择计算阶段日均存款</p>
            <p class="subtitle">支持日期选择，自动计算阶段天数，更加直观方便</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="toggle-container">
                    <div class="toggle-btn active" id="depositToggle">存款月日均</div>
                    <div class="toggle-btn" id="periodToggle">存款阶段日均</div>
                    <div class="toggle-btn" id="loanToggle">贷款日均</div>
                </div>
                
                <!-- 存款月日均计算器 -->
                <div class="calculator-type active" id="depositCalculator">
                    <h2 class="section-title">存款月日均计算</h2>
                    
                    <div class="form-group">
                        <label for="targetAvg">目标月日均存款 <span class="tooltip">?
                            <span class="tooltiptext">您希望达到的月平均每日存款余额。例如：希望本月平均每天有1万元存款。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="targetAvg" placeholder="请输入目标月日均存款" value="10000" min="0">
                            <span class="unit">元</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="currentDay">今天是本月第几天 <span class="tooltip">?
                            <span class="tooltiptext">今天是本月的第几天。例如：1号就是第1天，15号就是第15天。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="currentDay" placeholder="请输入今天是本月第几天" value="15" min="1" max="31">
                            <span class="unit">日</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="monthDays">本月总天数</label>
                        <select id="monthDays">
                            <option value="31">31天</option>
                            <option value="30">30天</option>
                            <option value="29">29天（闰年2月）</option>
                            <option value="28">28天（平年2月）</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="existingBalance">本月已有日均余额 <span class="tooltip">?
                            <span class="tooltiptext">从本月1号到昨天为止的平均每日存款余额。如果之前没有存款，则为0。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="existingBalance" placeholder="如无存款请填0" value="0" min="0">
                            <span class="unit">元</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="daysExisting">已有余额覆盖天数 <span class="tooltip">?
                            <span class="tooltiptext">已有日均余额覆盖了本月多少天。例如：如果您从1号到14号都有存款，则填14天。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="daysExisting" placeholder="已有余额覆盖的天数" value="0" min="0" max="31">
                            <span class="unit">天</span>
                        </div>
                    </div>
                    
                    <button class="btn" id="calculateDepositBtn">计算所需存款金额</button>
                    
                    <div class="example-section">
                        <div class="example-title">使用示例：</div>
                        <p>假设本月有30天，今天是第15天，目标月日均存款1万元，之前没有存款。</p>
                        <p>那么今天需要存入的金额为：<br>
                        <strong>10,000元 × 30天 ÷ (30天 - 15天 + 1) = 18,750元</strong></p>
                    </div>
                    
                    <div class="scenario-selector">
                        <div class="scenario-btn" data-type="deposit" data-target="10000" data-day="15" data-days="31" data-existing="0" data-days-existing="0">案例1: 月中开始</div>
                        <div class="scenario-btn" data-type="deposit" data-target="50000" data-day="10" data-days="30" data-existing="20000" data-days-existing="9">案例2: 已有部分存款</div>
                        <div class="scenario-btn" data-type="deposit" data-target="100000" data-day="25" data-days="31" data-existing="50000" data-days-existing="24">案例3: 月末冲刺</div>
                    </div>
                </div>
                
                <!-- 存款阶段日均计算器 - 日期版本 -->
                <div class="calculator-type" id="periodCalculator">
                    <h2 class="section-title">存款阶段日均计算 - 日期选择</h2>
                    
                    <div class="form-group">
                        <label for="targetPeriodAvg">目标阶段日均存款 <span class="tooltip">?
                            <span class="tooltiptext">您希望在一个特定阶段内达到的平均每日存款余额。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="targetPeriodAvg" placeholder="请输入目标阶段日均存款" value="15000" min="0">
                            <span class="unit">元</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>阶段日期范围</label>
                        <div class="date-input-group">
                            <div class="form-group">
                                <label for="periodStartDate" style="font-size: 12px; margin-bottom: 5px;">开始日期</label>
                                <input type="date" id="periodStartDate" value="">
                            </div>
                            <div style="color: #666; line-height: 46px; margin-top: 12px;">至</div>
                            <div class="form-group">
                                <label for="periodEndDate" style="font-size: 12px; margin-bottom: 5px;">结束日期</label>
                                <input type="date" id="periodEndDate" value="">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>计算日期</label>
                        <div class="calc-date-group">
                            <div class="form-group">
                                <input type="date" id="calcDate" value="">
                            </div>
                            <button class="today-btn" id="setTodayBtn">设为今天</button>
                        </div>
                    </div>
                    
                    <div class="date-info-display">
                        <div class="date-info-row">
                            <span class="date-info-label">阶段总天数：</span>
                            <span class="date-info-value" id="periodTotalDays">0 天</span>
                        </div>
                        <div class="date-info-row">
                            <span class="date-info-label">今天是阶段内第几天：</span>
                            <span class="date-info-value" id="periodCurrentDayNum">0 天</span>
                        </div>
                        <div class="date-info-row">
                            <span class="date-info-label">阶段剩余天数：</span>
                            <span class="date-info-value" id="periodRemainingDays">0 天</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="existingPeriodBalance">阶段内已有日均余额 <span class="tooltip">?
                            <span class="tooltiptext">从阶段开始日到昨天为止的平均每日存款余额。如果之前没有存款，则为0。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="existingPeriodBalance" placeholder="如无存款请填0" value="0" min="0">
                            <span class="unit">元</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="daysExistingPeriod">已有余额覆盖天数 <span class="tooltip">?
                            <span class="tooltiptext">已有日均余额覆盖了阶段内多少天。例如：阶段从10号开始，您从10号到14号都有存款，则填5天。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="daysExistingPeriod" placeholder="已有余额覆盖的天数" value="0" min="0" max="31">
                            <span class="unit">天</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-tertiary" id="calculatePeriodBtn">计算阶段所需存款金额</button>
                    
                    <div class="example-section">
                        <div class="example-title">使用示例：</div>
                        <p>假设阶段从2023-10-10到2023-10-25（共16天），今天是2023-10-15（阶段内第6天），目标阶段日均1.5万元，之前没有存款。</p>
                        <p>那么今天需要存入的金额为：<br>
                        <strong>15,000元 × 16天 ÷ (16天 - 6天 + 1) = 21,818元</strong></p>
                    </div>
                    
                    <div class="scenario-selector">
                        <div class="scenario-btn" data-type="period-date" data-target="15000" data-start="2023-10-10" data-end="2023-10-25" data-calc="2023-10-15" data-existing="0" data-days-existing="0">案例1: 阶段内中途开始</div>
                        <div class="scenario-btn" data-type="period-date" data-target="80000" data-start="2023-10-05" data-end="2023-10-20" data-calc="2023-10-14" data-existing="40000" data-days-existing="9">案例2: 阶段内已有部分存款</div>
                        <div class="scenario-btn" data-type="period-date" data-target="120000" data-start="2023-10-01" data-end="2023-10-10" data-calc="2023-10-08" data-existing="60000" data-days-existing="7">案例3: 短期冲刺阶段</div>
                    </div>
                </div>
                
                <!-- 贷款计算器 -->
                <div class="calculator-type" id="loanCalculator">
                    <h2 class="section-title">贷款日均计算</h2>
                    
                    <div class="form-group">
                        <label for="targetAvgLoan">目标月日均贷款 <span class="tooltip">?
                            <span class="tooltiptext">您希望达到的月平均每日贷款余额。例如：希望本月平均每天有50万元贷款余额。</span>
                        </span></label>
                        <div class="input-with-unit">
                            <input type="number" id="targetAvgLoan" placeholder="请输入目标月日均贷款" value="500000" min="0">
                            <span class="unit">元</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="currentDayLoan">今天是本月第几天</label>
                        <div class="input-with-unit">
                            <input type="number" id="currentDayLoan" placeholder="请输入今天是本月第几天" value="15" min="1" max="31">
                            <span class="unit">日</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="monthDaysLoan">本月总天数</label>
                        <select id="monthDaysLoan">
                            <option value="31">31天</option>
                            <option value="30">30天</option>
                            <option value="29">29天（闰年2月）</option>
                            <option value="28">28天（平年2月）</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="existingLoan">本月已有日均贷款余额</label>
                        <div class="input-with-unit">
                            <input type="number" id="existingLoan" placeholder="如无贷款请填0" value="0" min="0">
                            <span class="unit">元</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="daysExistingLoan">已有余额覆盖天数</label>
                        <div class="input-with-unit">
                            <input type="number" id="daysExistingLoan" placeholder="已有余额覆盖的天数" value="0" min="0" max="31">
                            <span class="unit">天</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" id="calculateLoanBtn">计算所需贷款金额</button>
                    
                    <div class="example-section">
                        <div class="example-title">贷款计算说明：</div>
                        <p>贷款日均计算原理与存款相同，只是应用场景不同。</p>
                        <p>计算公式：<br>
                        <strong>所需贷款金额 = (目标月日均贷款 × 本月总天数 - 已有日均贷款余额 × 已覆盖天数) ÷ 剩余天数</strong></p>
                    </div>
                    
                    <div class="scenario-selector">
                        <div class="scenario-btn" data-type="loan" data-target="500000" data-day="15" data-days="31" data-existing="0" data-days-existing="0">案例1: 月中开始</div>
                        <div class="scenario-btn" data-type="loan" data-target="1000000" data-day="10" data-days="30" data-existing="300000" data-days-existing="9">案例2: 已有部分贷款</div>
                        <div class="scenario-btn" data-type="loan" data-target="2000000" data-day="25" data-days="31" data-existing="1000000" data-days-existing="24">案例3: 月末冲刺</div>
                    </div>
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-tabs">
                    <div class="result-tab active" id="resultTabDeposit">存款月日均结果</div>
                    <div class="result-tab" id="resultTabPeriod">存款阶段日均结果</div>
                    <div class="result-tab" id="resultTabLoan">贷款日均结果</div>
                </div>
                
                <!-- 存款月日均结果 -->
                <div class="result-content active" id="resultContentDeposit">
                    <div class="result-card">
                        <div class="result-label">今日需要存入的金额</div>
                        <div class="result-value" id="requiredAmount">0 元</div>
                        <div class="result-note" id="resultNote">请填写左侧信息并点击计算按钮</div>
                        
                        <div class="details">
                            <p><strong>计算详情：</strong></p>
                            <p>目标月日均：<span id="displayTargetAvg">0</span> 元</p>
                            <p>本月总天数：<span id="displayMonthDays">0</span> 天</p>
                            <p>今天是本月第：<span id="displayCurrentDay">0</span> 天</p>
                            <p>本月已覆盖天数：<span id="displayDaysExisting">0</span> 天</p>
                            <p>已有日均余额：<span id="displayExistingBalance">0</span> 元</p>
                            <p>剩余天数：<span id="displayRemainingDays">0</span> 天</p>
                        </div>
                        
                        <div class="calculation-formula" id="formulaDisplay">
                            公式：所需金额 = (目标月日均 × 本月总天数 - 已有日均余额 × 已覆盖天数) ÷ 剩余天数
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">计算结果分析</div>
                        <div class="details" id="analysisText">
                            填写完整信息后，将显示详细分析和建议。
                        </div>
                    </div>
                </div>
                
                <!-- 存款阶段日均结果 -->
                <div class="result-content" id="resultContentPeriod">
                    <div class="result-card period-result-card">
                        <div class="result-label">今日需要存入的金额</div>
                        <div class="result-value" id="requiredPeriodAmount">0 元</div>
                        <div class="result-note" id="resultPeriodNote">请填写左侧阶段日均信息并点击计算按钮</div>
                        
                        <div class="details">
                            <p><strong>计算详情：</strong></p>
                            <p>目标阶段日均：<span id="displayTargetPeriodAvg">0</span> 元</p>
                            <p>阶段总天数：<span id="displayPeriodDays">0</span> 天</p>
                            <p>今天是阶段内第：<span id="displayPeriodCurrentDay">0</span> 天</p>
                            <p>阶段内已覆盖天数：<span id="displayDaysExistingPeriod">0</span> 天</p>
                            <p>已有日均余额：<span id="displayExistingPeriodBalance">0</span> 元</p>
                            <p>阶段剩余天数：<span id="displayPeriodRemainingDays">0</span> 天</p>
                        </div>
                        
                        <div class="calculation-formula" id="formulaPeriodDisplay">
                            公式：所需金额 = (目标阶段日均 × 阶段总天数 - 已有日均余额 × 已覆盖天数) ÷ 阶段剩余天数
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">阶段日均计算结果分析</div>
                        <div class="details" id="analysisPeriodText">
                            填写完整阶段信息后，将显示详细分析和建议。
                        </div>
                    </div>
                </div>
                
                <!-- 贷款日均结果 -->
                <div class="result-content" id="resultContentLoan">
                    <div class="result-card loan-result-card">
                        <div class="result-label">今日需要发放的贷款金额</div>
                        <div class="result-value" id="requiredLoanAmount">0 元</div>
                        <div class="result-note" id="resultLoanNote">请填写左侧贷款信息并点击计算按钮</div>
                        
                        <div class="details">
                            <p><strong>计算详情：</strong></p>
                            <p>目标月日均贷款：<span id="displayTargetAvgLoan">0</span> 元</p>
                            <p>本月总天数：<span id="displayMonthDaysLoan">0</span> 天</p>
                            <p>今天是本月第：<span id="displayCurrentDayLoan">0</span> 天</p>
                            <p>本月已覆盖天数：<span id="displayDaysExistingLoan">0</span> 天</p>
                            <p>已有日均贷款余额：<span id="displayExistingLoan">0</span> 元</p>
                            <p>剩余天数：<span id="displayRemainingDaysLoan">0</span> 天</p>
                        </div>
                        
                        <div class="calculation-formula" id="formulaLoanDisplay">
                            公式：所需贷款金额 = (目标月日均贷款 × 本月总天数 - 已有日均贷款余额 × 已覆盖天数) ÷ 剩余天数
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">贷款日均计算结果分析</div>
                        <div class="details" id="analysisLoanText">
                            填写完整贷款信息后，将显示详细分析和建议。
                        </div>
                    </div>
                </div>
                
                <!-- 汇总结果区域 -->
                <div class="result-card">
                    <div class="result-label">汇总计算结果</div>
                    <div class="summary-section">
                        <div class="summary-item">
                            <div class="summary-label">存款月日均目标</div>
                            <div class="summary-value" id="summaryDepositTarget">0 元</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">存款阶段日均目标</div>
                            <div class="summary-value" id="summaryPeriodTarget">0 元</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">贷款月日均目标</div>
                            <div class="summary-value" id="summaryLoanTarget">0 元</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">今日需要总金额</div>
                            <div class="summary-value" id="summaryTotalRequired">0 元</div>
                        </div>
                    </div>
                    <div class="result-note" style="margin-top: 15px;">
                        注：汇总金额为各计算模式结果的合计，方便您统筹规划。
                    </div>
                </div>
            </div>
            
            <div class="explanation-section">
                <h2 class="section-title">日均计算原理与应用</h2>
                
                <div class="explanation-content">
                    <h3>三种计算模式说明</h3>
                    <p><strong>1. 存款月日均计算：</strong>适用于整个月份的存款日均目标管理，帮助您规划全月存款任务。</p>
                    <p><strong>2. 存款阶段日均计算（日期版本）：</strong>使用日期选择器，直观选择阶段开始日期、结束日期和计算日期，自动计算阶段天数，适用于特定时间段的存款日均目标管理。</p>
                    <p><strong>3. 贷款日均计算：</strong>适用于贷款余额的日均目标管理，原理与存款相同，只是应用场景不同。</p>
                    
                    <h3>阶段日均计算原理</h3>
                    <p>阶段日均计算与月日均计算原理相同，只是将计算范围从"整月"缩小到"特定阶段"：</p>
                    <div class="calculation-formula">
                        所需金额 = (目标阶段日均 × 阶段总天数 - 已有日均余额 × 已覆盖天数) ÷ 阶段剩余天数
                    </div>
                    
                    <h3>日期版本的优势</h3>
                    <ul>
                        <li><strong>直观方便：</strong>通过日期选择器直接选择日期，避免手动计算天数错误</li>
                        <li><strong>自动计算：</strong>自动计算阶段总天数、今天是阶段内第几天、阶段剩余天数</li>
                        <li><strong>支持跨月：</strong>可以轻松处理跨月、跨年的阶段计算</li>
                        <li><strong>减少错误：</strong>避免了手动输入天数可能带来的计算错误</li>
                    </ul>
                    
                    <h3>应用场景举例</h3>
                    <ul>
                        <li><strong>季度考核：</strong>银行对客户经理的考核往往是按季度进行的，阶段日均计算可以帮助您规划季度内的存款目标。</li>
                        <li><strong>活动促销：</strong>银行开展存款促销活动时，通常有特定的活动时间段，阶段日均计算可以帮助客户规划活动期间的存款。</li>
                        <li><strong>客户资金周转：</strong>企业客户资金有特定的周转周期，阶段日均计算可以帮助客户在资金充裕时存入，资金紧张时取出。</li>
                        <li><strong>月末/季末冲刺：</strong>在考核期末，阶段日均计算可以帮助您精确计算冲刺阶段需要达到的存款目标。</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2023 存款阶段日均计算器 - 日期版本 | 客户经理专用工具 | 数据仅保存在本地浏览器</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const depositToggle = document.getElementById('depositToggle');
            const periodToggle = document.getElementById('periodToggle');
            const loanToggle = document.getElementById('loanToggle');
            const depositCalculator = document.getElementById('depositCalculator');
            const periodCalculator = document.getElementById('periodCalculator');
            const loanCalculator = document.getElementById('loanCalculator');
            
            // 结果选项卡
            const resultTabDeposit = document.getElementById('resultTabDeposit');
            const resultTabPeriod = document.getElementById('resultTabPeriod');
            const resultTabLoan = document.getElementById('resultTabLoan');
            const resultContentDeposit = document.getElementById('resultContentDeposit');
            const resultContentPeriod = document.getElementById('resultContentPeriod');
            const resultContentLoan = document.getElementById('resultContentLoan');
            
            // 计算按钮
            const calculateDepositBtn = document.getElementById('calculateDepositBtn');
            const calculatePeriodBtn = document.getElementById('calculatePeriodBtn');
            const calculateLoanBtn = document.getElementById('calculateLoanBtn');
            
            // 存款月日均计算器元素
            const targetAvgInput = document.getElementById('targetAvg');
            const currentDayInput = document.getElementById('currentDay');
            const monthDaysSelect = document.getElementById('monthDays');
            const existingBalanceInput = document.getElementById('existingBalance');
            const daysExistingInput = document.getElementById('daysExisting');
            
            // 存款阶段日均计算器元素 - 日期版本
            const targetPeriodAvgInput = document.getElementById('targetPeriodAvg');
            const periodStartDateInput = document.getElementById('periodStartDate');
            const periodEndDateInput = document.getElementById('periodEndDate');
            const calcDateInput = document.getElementById('calcDate');
            const setTodayBtn = document.getElementById('setTodayBtn');
            const existingPeriodBalanceInput = document.getElementById('existingPeriodBalance');
            const daysExistingPeriodInput = document.getElementById('daysExistingPeriod');
            
            // 日期信息显示元素
            const periodTotalDaysElement = document.getElementById('periodTotalDays');
            const periodCurrentDayNumElement = document.getElementById('periodCurrentDayNum');
            const periodRemainingDaysElement = document.getElementById('periodRemainingDays');
            
            // 贷款计算器元素
            const targetAvgLoanInput = document.getElementById('targetAvgLoan');
            const currentDayLoanInput = document.getElementById('currentDayLoan');
            const monthDaysLoanSelect = document.getElementById('monthDaysLoan');
            const existingLoanInput = document.getElementById('existingLoan');
            const daysExistingLoanInput = document.getElementById('daysExistingLoan');
            
            // 结果展示元素 - 存款月日均
            const requiredAmountElement = document.getElementById('requiredAmount');
            const resultNoteElement = document.getElementById('resultNote');
            const analysisTextElement = document.getElementById('analysisText');
            const formulaDisplayElement = document.getElementById('formulaDisplay');
            
            // 结果展示元素 - 存款阶段日均
            const requiredPeriodAmountElement = document.getElementById('requiredPeriodAmount');
            const resultPeriodNoteElement = document.getElementById('resultPeriodNote');
            const analysisPeriodTextElement = document.getElementById('analysisPeriodText');
            const formulaPeriodDisplayElement = document.getElementById('formulaPeriodDisplay');
            
            // 结果展示元素 - 贷款日均
            const requiredLoanAmountElement = document.getElementById('requiredLoanAmount');
            const resultLoanNoteElement = document.getElementById('resultLoanNote');
            const analysisLoanTextElement = document.getElementById('analysisLoanText');
            const formulaLoanDisplayElement = document.getElementById('formulaLoanDisplay');
            
            // 详情展示元素 - 存款月日均
            const displayTargetAvgElement = document.getElementById('displayTargetAvg');
            const displayMonthDaysElement = document.getElementById('displayMonthDays');
            const displayCurrentDayElement = document.getElementById('displayCurrentDay');
            const displayDaysExistingElement = document.getElementById('displayDaysExisting');
            const displayExistingBalanceElement = document.getElementById('displayExistingBalance');
            const displayRemainingDaysElement = document.getElementById('displayRemainingDays');
            
            // 详情展示元素 - 存款阶段日均
            const displayTargetPeriodAvgElement = document.getElementById('displayTargetPeriodAvg');
            const displayPeriodDaysElement = document.getElementById('displayPeriodDays');
            const displayPeriodCurrentDayElement = document.getElementById('displayPeriodCurrentDay');
            const displayDaysExistingPeriodElement = document.getElementById('displayDaysExistingPeriod');
            const displayExistingPeriodBalanceElement = document.getElementById('displayExistingPeriodBalance');
            const displayPeriodRemainingDaysElement = document.getElementById('displayPeriodRemainingDays');
            
            // 详情展示元素 - 贷款日均
            const displayTargetAvgLoanElement = document.getElementById('displayTargetAvgLoan');
            const displayMonthDaysLoanElement = document.getElementById('displayMonthDaysLoan');
            const displayCurrentDayLoanElement = document.getElementById('displayCurrentDayLoan');
            const displayDaysExistingLoanElement = document.getElementById('displayDaysExistingLoan');
            const displayExistingLoanElement = document.getElementById('displayExistingLoan');
            const displayRemainingDaysLoanElement = document.getElementById('displayRemainingDaysLoan');
            
            // 汇总结果元素
            const summaryDepositTargetElement = document.getElementById('summaryDepositTarget');
            const summaryPeriodTargetElement = document.getElementById('summaryPeriodTarget');
            const summaryLoanTargetElement = document.getElementById('summaryLoanTarget');
            const summaryTotalRequiredElement = document.getElementById('summaryTotalRequired');
            
            // 初始化日期输入框的默认值
            initializeDateInputs();
            
            // 切换计算器类型
            depositToggle.addEventListener('click', function() {
                setActiveCalculator('deposit');
                setActiveResultTab('deposit');
            });
            
            periodToggle.addEventListener('click', function() {
                setActiveCalculator('period');
                setActiveResultTab('period');
                updatePeriodDateInfo(); // 更新日期信息
            });
            
            loanToggle.addEventListener('click', function() {
                setActiveCalculator('loan');
                setActiveResultTab('loan');
            });
            
            // 切换结果选项卡
            resultTabDeposit.addEventListener('click', function() {
                setActiveResultTab('deposit');
            });
            
            resultTabPeriod.addEventListener('click', function() {
                setActiveResultTab('period');
            });
            
            resultTabLoan.addEventListener('click', function() {
                setActiveResultTab('loan');
            });
            
            // 存款计算按钮点击事件
            calculateDepositBtn.addEventListener('click', function() {
                calculateRequiredAmount('deposit');
            });
            
            // 阶段计算按钮点击事件
            calculatePeriodBtn.addEventListener('click', function() {
                calculateRequiredAmount('period');
            });
            
            // 贷款计算按钮点击事件
            calculateLoanBtn.addEventListener('click', function() {
                calculateRequiredAmount('loan');
            });
            
            // 设置今天按钮点击事件
            setTodayBtn.addEventListener('click', function() {
                const today = new Date();
                const formattedDate = formatDateForInput(today);
                calcDateInput.value = formattedDate;
                updatePeriodDateInfo(); // 更新日期信息
            });
            
            // 日期输入框变化时更新日期信息
            periodStartDateInput.addEventListener('change', function() {
                updatePeriodDateInfo();
            });
            
            periodEndDateInput.addEventListener('change', function() {
                updatePeriodDateInfo();
            });
            
            calcDateInput.addEventListener('change', function() {
                updatePeriodDateInfo();
            });
            
            // 示例场景按钮点击事件
            const scenarioButtons = document.querySelectorAll('.scenario-btn');
            scenarioButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const target = this.getAttribute('data-target');
                    
                    if (type === 'deposit') {
                        const day = this.getAttribute('data-day');
                        const days = this.getAttribute('data-days');
                        const existing = this.getAttribute('data-existing');
                        const daysExisting = this.getAttribute('data-days-existing');
                        
                        // 更新存款计算器输入
                        targetAvgInput.value = target;
                        currentDayInput.value = day;
                        monthDaysSelect.value = days;
                        existingBalanceInput.value = existing;
                        daysExistingInput.value = daysExisting;
                        
                        // 切换到存款计算器
                        setActiveCalculator('deposit');
                        setActiveResultTab('deposit');
                        
                        // 计算
                        calculateRequiredAmount('deposit');
                    } else if (type === 'period-date') {
                        const start = this.getAttribute('data-start');
                        const end = this.getAttribute('data-end');
                        const calc = this.getAttribute('data-calc');
                        const existing = this.getAttribute('data-existing');
                        const daysExisting = this.getAttribute('data-days-existing');
                        
                        // 更新阶段计算器输入
                        targetPeriodAvgInput.value = target;
                        periodStartDateInput.value = start;
                        periodEndDateInput.value = end;
                        calcDateInput.value = calc;
                        existingPeriodBalanceInput.value = existing;
                        daysExistingPeriodInput.value = daysExisting;
                        
                        // 切换到阶段计算器
                        setActiveCalculator('period');
                        setActiveResultTab('period');
                        
                        // 更新日期信息
                        updatePeriodDateInfo();
                        
                        // 计算
                        calculateRequiredAmount('period');
                    } else if (type === 'loan') {
                        const day = this.getAttribute('data-day');
                        const days = this.getAttribute('data-days');
                        const existing = this.getAttribute('data-existing');
                        const daysExisting = this.getAttribute('data-days-existing');
                        
                        // 更新贷款计算器输入
                        targetAvgLoanInput.value = target;
                        currentDayLoanInput.value = day;
                        monthDaysLoanSelect.value = days;
                        existingLoanInput.value = existing;
                        daysExistingLoanInput.value = daysExisting;
                        
                        // 切换到贷款计算器
                        setActiveCalculator('loan');
                        setActiveResultTab('loan');
                        
                        // 计算
                        calculateRequiredAmount('loan');
                    }
                    
                    // 激活当前示例按钮
                    scenarioButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // 初始化日期输入框
            function initializeDateInputs() {
                const today = new Date();
                const formattedToday = formatDateForInput(today);
                
                // 设置默认值：阶段开始日期为当月1号，结束日期为当月最后一天，计算日期为今天
                const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                
                const formattedFirstDay = formatDateForInput(firstDayOfMonth);
                const formattedLastDay = formatDateForInput(lastDayOfMonth);
                
                periodStartDateInput.value = formattedFirstDay;
                periodEndDateInput.value = formattedLastDay;
                calcDateInput.value = formattedToday;
                
                // 更新日期信息
                updatePeriodDateInfo();
            }
            
            // 更新阶段日期信息
            function updatePeriodDateInfo() {
                const startDate = new Date(periodStartDateInput.value);
                const endDate = new Date(periodEndDateInput.value);
                const calcDate = new Date(calcDateInput.value);
                
                // 验证日期有效性
                if (isNaN(startDate.getTime()) || isNaN(endDate.getTime()) || isNaN(calcDate.getTime())) {
                    return;
                }
                
                // 计算阶段总天数（包含开始和结束日）
                const timeDiff = endDate.getTime() - startDate.getTime();
                const totalDays = Math.floor(timeDiff / (1000 * 3600 * 24)) + 1;
                
                // 计算今天是阶段内第几天
                const calcTimeDiff = calcDate.getTime() - startDate.getTime();
                const currentDayNum = Math.floor(calcTimeDiff / (1000 * 3600 * 24)) + 1;
                
                // 计算剩余天数
                const remainingDays = totalDays - currentDayNum + 1;
                
                // 更新显示
                periodTotalDaysElement.textContent = totalDays + " 天";
                periodCurrentDayNumElement.textContent = currentDayNum + " 天";
                periodRemainingDaysElement.textContent = remainingDays + " 天";
                
                // 验证日期范围
                if (currentDayNum < 1 || currentDayNum > totalDays) {
                    periodCurrentDayNumElement.style.color = "#e74c3c";
                    periodCurrentDayNumElement.innerHTML = currentDayNum + " 天 <span style='font-size:12px;color:#e74c3c;'>(日期不在阶段内)</span>";
                } else {
                    periodCurrentDayNumElement.style.color = "";
                }
                
                if (totalDays <= 0) {
                    periodTotalDaysElement.style.color = "#e74c3c";
                } else {
                    periodTotalDaysElement.style.color = "";
                }
            }
            
            // 设置活动计算器
            function setActiveCalculator(type) {
                // 重置所有计算器
                depositToggle.classList.remove('active');
                periodToggle.classList.remove('active');
                loanToggle.classList.remove('active');
                depositCalculator.classList.remove('active');
                periodCalculator.classList.remove('active');
                loanCalculator.classList.remove('active');
                
                // 设置活动计算器
                if (type === 'deposit') {
                    depositToggle.classList.add('active');
                    depositCalculator.classList.add('active');
                } else if (type === 'period') {
                    periodToggle.classList.add('active');
                    periodCalculator.classList.add('active');
                } else if (type === 'loan') {
                    loanToggle.classList.add('active');
                    loanCalculator.classList.add('active');
                }
            }
            
            // 设置活动结果选项卡
            function setActiveResultTab(type) {
                // 重置所有结果选项卡
                resultTabDeposit.classList.remove('active');
                resultTabPeriod.classList.remove('active');
                resultTabLoan.classList.remove('active');
                resultContentDeposit.classList.remove('active');
                resultContentPeriod.classList.remove('active');
                resultContentLoan.classList.remove('active');
                
                // 设置活动结果选项卡
                if (type === 'deposit') {
                    resultTabDeposit.classList.add('active');
                    resultContentDeposit.classList.add('active');
                } else if (type === 'period') {
                    resultTabPeriod.classList.add('active');
                    resultContentPeriod.classList.add('active');
                } else if (type === 'loan') {
                    resultTabLoan.classList.add('active');
                    resultContentLoan.classList.add('active');
                }
            }
            
            // 计算所需金额的主要函数
            function calculateRequiredAmount(type) {
                let targetAvg, periodDays, currentDay, existingBalance, daysExisting, remainingDays;
                let formula = "";
                let requiredAmount = 0;
                
                if (type === 'deposit') {
                    // 获取存款月日均输入值
                    targetAvg = parseFloat(targetAvgInput.value) || 0;
                    currentDay = parseInt(currentDayInput.value) || 1;
                    periodDays = parseInt(monthDaysSelect.value) || 31; // 这里使用periodDays变量存储月总天数
                    existingBalance = parseFloat(existingBalanceInput.value) || 0;
                    daysExisting = parseInt(daysExistingInput.value) || 0;
                    
                    // 验证输入
                    if (targetAvg <= 0) {
                        alert("请输入有效的目标月日均金额");
                        return;
                    }
                    
                    if (currentDay < 1 || currentDay > periodDays) {
                        alert("当前日期必须在本月天数范围内");
                        return;
                    }
                    
                    if (daysExisting > currentDay - 1) {
                        alert("已有余额覆盖天数不能超过当前日期减1");
                        return;
                    }
                    
                    // 计算剩余天数（包含今天）
                    remainingDays = periodDays - currentDay + 1;
                    
                    // 计算所需金额
                    if (existingBalance > 0 && daysExisting > 0) {
                        // 有已有余额的情况
                        requiredAmount = (targetAvg * periodDays - existingBalance * daysExisting) / remainingDays;
                        formula = `所需金额 = (${formatNumber(targetAvg)} × ${periodDays} - ${formatNumber(existingBalance)} × ${daysExisting}) ÷ ${remainingDays}`;
                    } else {
                        // 没有已有余额的情况
                        requiredAmount = (targetAvg * periodDays) / remainingDays;
                        formula = `所需金额 = ${formatNumber(targetAvg)} × ${periodDays} ÷ ${remainingDays}`;
                    }
                    
                    // 如果计算结果是负数，说明已有余额已经超过目标，不需要再存入
                    if (requiredAmount < 0) {
                        requiredAmount = 0;
                    }
                    
                    // 更新显示
                    displayTargetAvgElement.textContent = formatNumber(targetAvg);
                    displayMonthDaysElement.textContent = periodDays;
                    displayCurrentDayElement.textContent = currentDay;
                    displayDaysExistingElement.textContent = daysExisting;
                    displayExistingBalanceElement.textContent = formatNumber(existingBalance);
                    displayRemainingDaysElement.textContent = remainingDays;
                    
                    requiredAmountElement.textContent = formatNumber(Math.ceil(requiredAmount)) + " 元";
                    formulaDisplayElement.textContent = "公式：" + formula;
                    
                    // 更新结果说明和分析
                    updateResultNote(type, requiredAmount, targetAvg, currentDay, periodDays, existingBalance, daysExisting);
                    
                    // 更新汇总结果
                    updateSummaryResults();
                    
                } else if (type === 'period') {
                    // 获取存款阶段日均输入值 - 日期版本
                    targetAvg = parseFloat(targetPeriodAvgInput.value) || 0;
                    existingBalance = parseFloat(existingPeriodBalanceInput.value) || 0;
                    daysExisting = parseInt(daysExistingPeriodInput.value) || 0;
                    
                    // 获取日期信息
                    const startDate = new Date(periodStartDateInput.value);
                    const endDate = new Date(periodEndDateInput.value);
                    const calcDate = new Date(calcDateInput.value);
                    
                    // 验证输入
                    if (targetAvg <= 0) {
                        alert("请输入有效的目标阶段日均金额");
                        return;
                    }
                    
                    if (isNaN(startDate.getTime()) || isNaN(endDate.getTime()) || isNaN(calcDate.getTime())) {
                        alert("请选择有效的日期");
                        return;
                    }
                    
                    // 计算阶段总天数
                    const timeDiff = endDate.getTime() - startDate.getTime();
                    periodDays = Math.floor(timeDiff / (1000 * 3600 * 24)) + 1;
                    
                    if (periodDays <= 0) {
                        alert("阶段结束日期必须晚于开始日期");
                        return;
                    }
                    
                    // 计算今天是阶段内第几天
                    const calcTimeDiff = calcDate.getTime() - startDate.getTime();
                    currentDay = Math.floor(calcTimeDiff / (1000 * 3600 * 24)) + 1;
                    
                    if (currentDay < 1 || currentDay > periodDays) {
                        alert("计算日期必须在阶段日期范围内");
                        return;
                    }
                    
                    if (daysExisting > currentDay - 1) {
                        alert("已有余额覆盖天数不能超过当前阶段天数减1");
                        return;
                    }
                    
                    // 计算剩余天数（包含今天）
                    remainingDays = periodDays - currentDay + 1;
                    
                    // 计算所需金额
                    if (existingBalance > 0 && daysExisting > 0) {
                        // 有已有余额的情况
                        requiredAmount = (targetAvg * periodDays - existingBalance * daysExisting) / remainingDays;
                        formula = `所需金额 = (${formatNumber(targetAvg)} × ${periodDays} - ${formatNumber(existingBalance)} × ${daysExisting}) ÷ ${remainingDays}`;
                    } else {
                        // 没有已有余额的情况
                        requiredAmount = (targetAvg * periodDays) / remainingDays;
                        formula = `所需金额 = ${formatNumber(targetAvg)} × ${periodDays} ÷ ${remainingDays}`;
                    }
                    
                    // 如果计算结果是负数，说明已有余额已经超过目标，不需要再存入
                    if (requiredAmount < 0) {
                        requiredAmount = 0;
                    }
                    
                    // 更新显示
                    displayTargetPeriodAvgElement.textContent = formatNumber(targetAvg);
                    displayPeriodDaysElement.textContent = periodDays;
                    displayPeriodCurrentDayElement.textContent = currentDay;
                    displayDaysExistingPeriodElement.textContent = daysExisting;
                    displayExistingPeriodBalanceElement.textContent = formatNumber(existingBalance);
                    displayPeriodRemainingDaysElement.textContent = remainingDays;
                    
                    requiredPeriodAmountElement.textContent = formatNumber(Math.ceil(requiredAmount)) + " 元";
                    formulaPeriodDisplayElement.textContent = "公式：" + formula;
                    
                    // 更新结果说明和分析
                    updateResultNote(type, requiredAmount, targetAvg, currentDay, periodDays, existingBalance, daysExisting);
                    
                    // 更新汇总结果
                    updateSummaryResults();
                    
                } else if (type === 'loan') {
                    // 获取贷款输入值
                    targetAvg = parseFloat(targetAvgLoanInput.value) || 0;
                    currentDay = parseInt(currentDayLoanInput.value) || 1;
                    periodDays = parseInt(monthDaysLoanSelect.value) || 31;
                    existingBalance = parseFloat(existingLoanInput.value) || 0;
                    daysExisting = parseInt(daysExistingLoanInput.value) || 0;
                    
                    // 验证输入
                    if (targetAvg <= 0) {
                        alert("请输入有效的目标月日均贷款金额");
                        return;
                    }
                    
                    if (currentDay < 1 || currentDay > periodDays) {
                        alert("当前日期必须在本月天数范围内");
                        return;
                    }
                    
                    if (daysExisting > currentDay - 1) {
                        alert("已有余额覆盖天数不能超过当前日期减1");
                        return;
                    }
                    
                    // 计算剩余天数（包含今天）
                    remainingDays = periodDays - currentDay + 1;
                    
                    // 计算所需金额
                    if (existingBalance > 0 && daysExisting > 0) {
                        // 有已有余额的情况
                        requiredAmount = (targetAvg * periodDays - existingBalance * daysExisting) / remainingDays;
                        formula = `所需贷款金额 = (${formatNumber(targetAvg)} × ${periodDays} - ${formatNumber(existingBalance)} × ${daysExisting}) ÷ ${remainingDays}`;
                    } else {
                        // 没有已有余额的情况
                        requiredAmount = (targetAvg * periodDays) / remainingDays;
                        formula = `所需贷款金额 = ${formatNumber(targetAvg)} × ${periodDays} ÷ ${remainingDays}`;
                    }
                    
                    // 如果计算结果是负数，说明已有余额已经超过目标，不需要再贷款
                    if (requiredAmount < 0) {
                        requiredAmount = 0;
                    }
                    
                    // 更新显示
                    displayTargetAvgLoanElement.textContent = formatNumber(targetAvg);
                    displayMonthDaysLoanElement.textContent = periodDays;
                    displayCurrentDayLoanElement.textContent = currentDay;
                    displayDaysExistingLoanElement.textContent = daysExisting;
                    displayExistingLoanElement.textContent = formatNumber(existingBalance);
                    displayRemainingDaysLoanElement.textContent = remainingDays;
                    
                    requiredLoanAmountElement.textContent = formatNumber(Math.ceil(requiredAmount)) + " 元";
                    formulaLoanDisplayElement.textContent = "公式：" + formula;
                    
                    // 更新结果说明和分析
                    updateResultNote(type, requiredAmount, targetAvg, currentDay, periodDays, existingBalance, daysExisting);
                    
                    // 更新汇总结果
                    updateSummaryResults();
                }
            }
            
            // 更新结果说明和分析
            function updateResultNote(type, requiredAmount, targetAvg, currentDay, totalDays, existingBalance, daysExisting) {
                const remainingDays = totalDays - currentDay + 1;
                
                let productType = "";
                let resultNoteElement, analysisTextElement;
                
                if (type === 'deposit') {
                    productType = '存款';
                    resultNoteElement = document.getElementById('resultNote');
                    analysisTextElement = document.getElementById('analysisText');
                } else if (type === 'period') {
                    productType = '存款';
                    resultNoteElement = document.getElementById('resultPeriodNote');
                    analysisTextElement = document.getElementById('analysisPeriodText');
                } else if (type === 'loan') {
                    productType = '贷款';
                    resultNoteElement = document.getElementById('resultLoanNote');
                    analysisTextElement = document.getElementById('analysisLoanText');
                }
                
                // 结果说明
                let noteText = "";
                if (requiredAmount <= 0) {
                    noteText = `恭喜！您已超额完成目标，无需新增${productType}`;
                } else if (existingBalance > 0) {
                    noteText = `考虑到已有${formatNumber(existingBalance)}元覆盖了${daysExisting}天，今天需要${productType}${formatNumber(Math.ceil(requiredAmount))}元`;
                } else {
                    noteText = `今天需要${productType}${formatNumber(Math.ceil(requiredAmount))}元，并保持到${type === 'period' ? '阶段结束' : '月底'}`;
                }
                resultNoteElement.textContent = noteText;
                
                // 分析文本
                let analysisText = "";
                
                if (requiredAmount <= 0) {
                    analysisText = `
                        <p><strong>🎉 超额完成目标！</strong></p>
                        <p>您目前的${productType}余额已经超过了${type === 'period' ? '阶段' : '本月'}目标日均${formatNumber(targetAvg)}元。</p>
                        <p>继续保持现有余额，${type === 'period' ? '阶段结束时' : '月底时'}您的实际日均将超过目标值。</p>
                    `;
                } else if (remainingDays <= 3) {
                    analysisText = `
                        <p><strong>⚠️ 时间紧迫，需要立即行动！</strong></p>
                        <p>${type === 'period' ? '阶段' : '本月'}只剩下${remainingDays}天，要达到目标日均${formatNumber(targetAvg)}元，今天需要${productType}${formatNumber(Math.ceil(requiredAmount))}元。</p>
                        <p><strong>建议：</strong></p>
                        <ul>
                            <li>立即联系大客户，争取大额${productType}</li>
                            <li>考虑是否可以将部分理财或其他资金转为${productType}</li>
                            <li>如果无法完成，考虑调整目标或制定${type === 'period' ? '下一阶段' : '下月'}计划</li>
                        </ul>
                    `;
                } else if (remainingDays <= 10) {
                    analysisText = `
                        <p><strong>📈 需要加大努力！</strong></p>
                        <p>${type === 'period' ? '阶段' : '本月'}还有${remainingDays}天，要达到目标日均${formatNumber(targetAvg)}元，今天需要${productType}${formatNumber(Math.ceil(requiredAmount))}元。</p>
                        <p><strong>建议：</strong></p>
                        <ul>
                            <li>本周内完成${productType}任务，避免${type === 'period' ? '阶段末' : '月末'}压力</li>
                            <li>重点跟进意向客户，争取尽快成交</li>
                            <li>考虑分2-3次完成，减轻单次压力</li>
                        </ul>
                    `;
                } else {
                    analysisText = `
                        <p><strong>✅ 计划可行，按部就班推进</strong></p>
                        <p>${type === 'period' ? '阶段' : '本月'}还有${remainingDays}天，要达到目标日均${formatNumber(targetAvg)}元，今天需要${productType}${formatNumber(Math.ceil(requiredAmount))}元。</p>
                        <p><strong>建议：</strong></p>
                        <ul>
                            <li>按计划推进，不必急于一时</li>
                            <li>可以分次完成，逐步达到目标</li>
                            <li>保持与客户沟通，确保${productType}稳定</li>
                        </ul>
                    `;
                }
                
                // 添加通用建议
                if (type === 'period') {
                    const startDate = new Date(periodStartDateInput.value);
                    const endDate = new Date(periodEndDateInput.value);
                    const calcDate = new Date(calcDateInput.value);
                    
                    const startDateStr = formatDateForDisplay(startDate);
                    const endDateStr = formatDateForDisplay(endDate);
                    const calcDateStr = formatDateForDisplay(calcDate);
                    
                    analysisText += `
                        <p><strong>💡 阶段信息：</strong></p>
                        <ul>
                            <li>阶段范围：${startDateStr} 至 ${endDateStr}</li>
                            <li>计算日期：${calcDateStr}</li>
                            <li>阶段总天数：${totalDays} 天</li>
                            <li>今天是阶段内第：${currentDay} 天</li>
                            <li>阶段剩余天数：${remainingDays} 天</li>
                        </ul>
                    `;
                }
                
                analysisTextElement.innerHTML = analysisText;
            }
            
            // 更新汇总结果
            function updateSummaryResults() {
                // 获取各计算结果
                const depositTarget = parseFloat(targetAvgInput.value) || 0;
                const periodTarget = parseFloat(targetPeriodAvgInput.value) || 0;
                const loanTarget = parseFloat(targetAvgLoanInput.value) || 0;
                
                // 获取各计算所需的金额
                const depositRequiredText = requiredAmountElement.textContent;
                const periodRequiredText = requiredPeriodAmountElement.textContent;
                const loanRequiredText = requiredLoanAmountElement.textContent;
                
                // 提取数字部分
                const depositRequired = extractNumber(depositRequiredText);
                const periodRequired = extractNumber(periodRequiredText);
                const loanRequired = extractNumber(loanRequiredText);
                
                // 计算总金额
                const totalRequired = depositRequired + periodRequired + loanRequired;
                
                // 更新显示
                summaryDepositTargetElement.textContent = formatNumber(depositTarget) + " 元";
                summaryPeriodTargetElement.textContent = formatNumber(periodTarget) + " 元";
                summaryLoanTargetElement.textContent = formatNumber(loanTarget) + " 元";
                summaryTotalRequiredElement.textContent = formatNumber(totalRequired) + " 元";
            }
            
            // 从文本中提取数字
            function extractNumber(text) {
                const match = text.match(/[\d,]+/);
                if (match) {
                    return parseFloat(match[0].replace(/,/g, '')) || 0;
                }
                return 0;
            }
            
            // 格式化数字，添加千位分隔符
            function formatNumber(num) {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            // 格式化日期为YYYY-MM-DD格式（用于输入框）
            function formatDateForInput(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            
            // 格式化日期为YYYY年MM月DD日格式（用于显示）
            function formatDateForDisplay(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}年${month}月${day}日`;
            }
            
            // 页面加载时自动计算存款月日均
            calculateRequiredAmount('deposit');
        });
    </script>
</body>
</html>
